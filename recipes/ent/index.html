<!doctype html><html><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=.9,maximum-scale=.9"><meta name=description content="graphql servers the easy way"><title>Ent Integration &mdash; gqlgen</title><link href="https://fonts.googleapis.com/css?family=Roboto:400,400i,700|Source+Code+Pro:400,700|Work+Sans:500,700" rel=stylesheet><link rel=stylesheet href="https://gqlgen.com/main.css?v=3" type=text/css><link rel=stylesheet href="https://gqlgen.com/syntax.css?v=2" type=text/css><script async src="https://www.googletagmanager.com/gtag/js?id=UA-116208894-2"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}
gtag('js',new Date());gtag('config','UA-116208894-2');</script><script src="https://gqlgen.com/main.js?v=1" async></script></head><body><div class=version-switcher><span></span><div class=version-switcher-options><a class=version-switcher-option></a></div></div><div class=layout--logo><a class=logo href=http://github.com/99designs/gqlgen><svg viewBox="0 0 31.92 31.43" xmlns="http://www.w3.org/2000/svg"><g transform="translate(-79.29 -106.7)"><path transform="matrix(.2646 0 0 .2646 79.29 106.7)" d="m31.95.0c-5.673.0-10.27 4.598-10.27 10.27.0.5862.06001 1.157.1543 1.717l-19.74 11.39c-1.239.5653-2.1 1.816-2.1 3.266v65.51h.01562c.001603 1.235.6446 2.437 1.793 3.096l20.03 11.56c-.09429.5594-.1543 1.131-.1543 1.717.0 5.673 4.598 10.27 10.27 10.27 5.674.0 10.27-4.6 10.27-10.27.0-5.673-4.598-10.27-10.27-10.27-2.492.0-4.774.8879-6.553 2.363l-18.22-10.52v-61.4l18.22-10.52c1.778 1.475 4.061 2.363 6.553 2.363 5.674.0 10.27-4.6 10.27-10.27.0-5.673-4.598-10.27-10.27-10.27zm56.73.0c-5.673.0-10.27 4.598-10.27 10.27.0 5.673 4.598 10.27 10.27 10.27 2.492.0 4.776-.8879 6.555-2.363l18.22 10.52v61.4l-18.22 10.52c-1.778-1.474-4.062-2.361-6.553-2.361-5.673.0-10.27 4.598-10.27 10.27.0 5.673 4.598 10.27 10.27 10.27 5.675.0 10.27-4.6 10.27-10.27.0-.5862-.06002-1.157-.1543-1.717l19.74-11.39c1.239-.5653 2.1-1.814 2.1-3.264v-65.51h-.01562c-.00133-1.236-.6437-2.438-1.793-3.098l-20.03-11.56c.09428-.5594.1543-1.131.1543-1.717.0-5.673-4.597-10.27-10.27-10.27zm-28.37 20.76c-5.675.0-10.27 4.598-10.27 10.27.0 1.524.3402 2.967.9355 4.268l-14.76 14.76c-1.301-.5953-2.742-.9355-4.266-.9355-5.673.0-10.27 4.598-10.27 10.27.0 5.673 4.598 10.27 10.27 10.27 1.524.0 2.963-.3406 4.264-.9355l14.77 14.77c-.5953 1.301-.9355 2.742-.9355 4.266.0 5.673 4.599 10.27 10.27 10.27 5.672.0 10.27-4.596 10.27-10.27.0-1.524-.3401-2.965-.9355-4.266l15.63-15.63c.5748.0998 1.162.1621 1.766.1621 5.675.0 10.27-4.598 10.27-10.27.0-5.675-4.599-10.27-10.27-10.27-1.524.0-2.965.3404-4.266.9355l-13.13-13.13c.5954-1.301.9355-2.743.9355-4.268.0-5.673-4.599-10.27-10.27-10.27zm-4.266 19.61c1.3.5949 2.742.9355 4.266.9355 1.523.0 2.964-.3408 4.264-.9355l13.13 13.13c-.5948 1.3-.9355 2.742-.9355 4.266.0 2.377.8147 4.558 2.17 6.299l-14.36 14.37c-1.3-.5947-2.741-.9336-4.264-.9336-1.524.0-2.965.3388-4.266.9336l-14.77-14.77c.5949-1.3.9355-2.74.9355-4.264.0-1.523-.3389-2.964-.9336-4.264l14.76-14.77z"/></g></svg><span class=logo--name>gqlgen</span></a></div><nav><input class=hamburger-toggle type=checkbox><div class=hamburger><span></span><span></span><span></span></div><ul class=menu><li><a class=menu-item href=https://gqlgen.com/>Introduction</a></li><li><a class=menu-item href=https://gqlgen.com/getting-started/>Getting Started</a></li><li><a class=menu-item href=https://gqlgen.com/config/>Configuration</a></li><li><a class=menu-item href=https://gqlgen.com/feature-comparison/>Feature Comparison</a></li><li><span class="menu-item submenu-heading">Reference</span><ul class=submenu><li><a class=menu-item href=https://gqlgen.com/reference/apq/>APQ</a></li><li><a class=menu-item href=https://gqlgen.com/reference/changesets/>Changesets</a></li><li><a class=menu-item href=https://gqlgen.com/reference/dataloaders/>Dataloaders</a></li><li><a class=menu-item href=https://gqlgen.com/reference/field-collection/>Field Collection</a></li><li><a class=menu-item href=https://gqlgen.com/reference/file-upload/>File Upload</a></li><li><a class=menu-item href=https://gqlgen.com/reference/errors/>Handling Errors</a></li><li><a class=menu-item href=https://gqlgen.com/reference/introspection/>Introspection</a></li><li><a class=menu-item href=https://gqlgen.com/reference/plugins/>Plugins</a></li><li><a class=menu-item href=https://gqlgen.com/reference/complexity/>Query Complexity</a></li><li><a class=menu-item href=https://gqlgen.com/reference/resolvers/>Resolvers</a></li><li><a class=menu-item href=https://gqlgen.com/reference/scalars/>Scalars</a></li><li><a class=menu-item href=https://gqlgen.com/reference/directives/>Schema Directives</a></li><li><a class=menu-item href=https://godoc.org/github.com/99designs/gqlgen>godoc
<span class=icon><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><path d="M576 24v127.984c0 21.461-25.96 31.98-40.971 16.971l-35.707-35.709-243.523 243.523c-9.373 9.373-24.568 9.373-33.941.0l-22.627-22.627c-9.373-9.373-9.373-24.569.0-33.941L442.756 76.676l-35.703-35.705C391.982 25.9 402.656.0 424.024.0H552c13.255.0 24 10.745 24 24zM407.029 270.794l-16 16A23.999 23.999.0 00384 303.765V448H64V128h264a24.003 24.003.0 0016.97-7.029l16-16C376.089 89.851 365.381 64 344 64H48C21.49 64 0 85.49.0 112v352c0 26.51 21.49 48 48 48h352c26.51.0 48-21.49 48-48V287.764c0-21.382-25.852-32.09-40.971-16.97z"/></svg></span></a></li></ul></li><li><span class="menu-item submenu-heading">Recipes</span><ul class=submenu><li><a class=menu-item href=https://gqlgen.com/recipes/federation/>Apollo Federation</a></li><li><a class=menu-item href=https://gqlgen.com/recipes/authentication/>Authentication</a></li><li><a class=menu-item href=https://gqlgen.com/recipes/cors/>CORS</a></li><li class=active><a class=menu-item href=https://gqlgen.com/recipes/ent/>Ent</a></li><li><a class=menu-item href=https://gqlgen.com/recipes/gin/>Gin</a></li><li><a class=menu-item href=https://gqlgen.com/recipes/migration-0.11/>Migrating to 0.11</a></li><li><a class=menu-item href=https://gqlgen.com/recipes/modelgen-hook/>Modelgen hook</a></li></ul></li></ul></nav><header><div class=content><h1>Ent</h1><div class=description>Ent Integration</div><a class=header-link target=_blank href=https://github.com/99designs/gqlgen/blob/master/docs/content/recipes/ent.md>[edit]</a></div></header><main><div class=content><p>ent フレームワークは、<a href=templates.md>外部テンプレート</a>オプションを使用して<a href=https://github.com/99designs/gqlgen>99designs gqlgen</a>ライブラリを介して GraphQL との統合を提供します（つまり、他のライブラリもサポートします）。</p><h2 id=quick-introduction>Quick Introduction</h2><p>プロジェクトに <a href=https://github.com/facebookincubator/ent-contrib/tree/master/entgql><code>entgql</code></a> 拡張機能を有効にするには、ここで説明したように <code>entc</code> (ent codegen) パッケージを使用する必要があります。
以下の 3 つのステップを踏んで、プロジェクトを有効にしてください。</p><p>1. 新規に <code>ent/entc.go</code> という名前の Go ファイルを作成し、以下の内容を貼り付けます。</p><div class=highlight><pre class=chroma><code class=language-go data-lang=go><span class=c1>// +build ignore
</span><span class=c1></span>
<span class=kn>package</span> <span class=nx>main</span>

<span class=kn>import</span> <span class=p>(</span>
	<span class=s>&#34;log&#34;</span>

	<span class=s>&#34;github.com/facebook/ent/entc&#34;</span>
	<span class=s>&#34;github.com/facebook/ent/entc/gen&#34;</span>
	<span class=s>&#34;github.com/facebookincubator/ent-contrib/entgql&#34;</span>
<span class=p>)</span>

<span class=kd>func</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
	<span class=nx>err</span> <span class=o>:=</span> <span class=nx>entc</span><span class=p>.</span><span class=nf>Generate</span><span class=p>(</span><span class=s>&#34;./schema&#34;</span><span class=p>,</span> <span class=o>&amp;</span><span class=nx>gen</span><span class=p>.</span><span class=nx>Config</span><span class=p>{</span>
		<span class=nx>Templates</span><span class=p>:</span> <span class=nx>entgql</span><span class=p>.</span><span class=nx>AllTemplates</span><span class=p>,</span>
	<span class=p>})</span>
	<span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
		<span class=nx>log</span><span class=p>.</span><span class=nf>Fatalf</span><span class=p>(</span><span class=s>&#34;running ent codegen: %v&#34;</span><span class=p>,</span> <span class=nx>err</span><span class=p>)</span>
	<span class=p>}</span>
<span class=p>}</span>
</code></pre></div><p>2. <code>ent/generate.go</code>ファイルを編集して、<code>ent/entc.go</code>ファイルを実行します。</p><div class=highlight><pre class=chroma><code class=language-go data-lang=go><span class=kn>package</span> <span class=nx>ent</span>

<span class=c1>//go:generate go run entc.go
</span></code></pre></div><p>ビルドタグを使って <code>ent/entc.go</code> は無視され、<code>generate.go</code> ファイルを通して <code>go generate</code> コマンドによって実行されることに注意してください。完全な例は <a href=https://github.com/facebookincubator/ent-contrib/blob/master/entgql/internal/todo>ent-contrib リポジトリ</a> にあります。</p><p>3. コード生成を実行します</p><pre><code class=language-console data-lang=console>go generate ./...
</code></pre><p>コード生成を実行すると、次のアドオンがプロジェクトに追加されます。</p><h2 id=node-api>Node API</h2><p>A new file named <code>ent/node.go</code> was created that implements the <a href=https://relay.dev/docs/en/graphql-server-specification.html#object-identification>Relay Node interface</a>.</p><p>In order to use the new generated <code>ent.Noder</code> interface in the <a href=https://gqlgen.com/reference/resolvers/>GraphQL resolver</a>, add the <code>Node</code> method to the query resolver, and look at the <a href=#gql-configuration>configuration</a> section to understand how to use it.</p><p>If you are using the <a href=migrate.md#universal-ids>Universal IDs</a> option in the schema migration, the NodeType is derived from the id value and can be used as follows:</p><div class=highlight><pre class=chroma><code class=language-go data-lang=go><span class=kd>func</span> <span class=p>(</span><span class=nx>r</span> <span class=o>*</span><span class=nx>queryResolver</span><span class=p>)</span> <span class=nf>Node</span><span class=p>(</span><span class=nx>ctx</span> <span class=nx>context</span><span class=p>.</span><span class=nx>Context</span><span class=p>,</span> <span class=nx>id</span> <span class=kt>int</span><span class=p>)</span> <span class=p>(</span><span class=nx>ent</span><span class=p>.</span><span class=nx>Noder</span><span class=p>,</span> <span class=kt>error</span><span class=p>)</span> <span class=p>{</span>
	<span class=k>return</span> <span class=nx>r</span><span class=p>.</span><span class=nx>client</span><span class=p>.</span><span class=nf>Noder</span><span class=p>(</span><span class=nx>ctx</span><span class=p>,</span> <span class=nx>id</span><span class=p>)</span>
<span class=p>}</span>
</code></pre></div><p>However, if you use a custom format for the global unique identifiers, you can control the NodeType as follows:</p><div class=highlight><pre class=chroma><code class=language-go data-lang=go><span class=kd>func</span> <span class=p>(</span><span class=nx>r</span> <span class=o>*</span><span class=nx>queryResolver</span><span class=p>)</span> <span class=nf>Node</span><span class=p>(</span><span class=nx>ctx</span> <span class=nx>context</span><span class=p>.</span><span class=nx>Context</span><span class=p>,</span> <span class=nx>guid</span> <span class=kt>string</span><span class=p>)</span> <span class=p>(</span><span class=nx>ent</span><span class=p>.</span><span class=nx>Noder</span><span class=p>,</span> <span class=kt>error</span><span class=p>)</span> <span class=p>{</span>
	<span class=nx>typ</span><span class=p>,</span> <span class=nx>id</span> <span class=o>:=</span> <span class=nf>parseGUID</span><span class=p>(</span><span class=nx>guid</span><span class=p>)</span>
	<span class=k>return</span> <span class=nx>r</span><span class=p>.</span><span class=nx>client</span><span class=p>.</span><span class=nf>Noder</span><span class=p>(</span><span class=nx>ctx</span><span class=p>,</span> <span class=nx>id</span><span class=p>,</span> <span class=nx>ent</span><span class=p>.</span><span class=nf>WithNodeType</span><span class=p>(</span><span class=nx>typ</span><span class=p>))</span>
<span class=p>}</span>
</code></pre></div><h2 id=gql-configuration>GQL Configuration</h2><p>Here&rsquo;s a configuration example for a todo app as exists in <a href=https://github.com/facebookincubator/ent-contrib/tree/master/entgql/internal/todo>ent-contrib/entgql/todo</a>.</p><div class=highlight><pre class=chroma><code class=language-yaml data-lang=yaml><span class=nt>schema</span><span class=p>:</span><span class=w>
</span><span class=w>  </span>- <span class=l>todo.graphql</span><span class=w>
</span><span class=w>
</span><span class=w></span><span class=nt>resolver</span><span class=p>:</span><span class=w>
</span><span class=w>  </span><span class=c># Tell gqlgen to generate resolvers next to the schema file.</span><span class=w>
</span><span class=w>  </span><span class=nt>layout</span><span class=p>:</span><span class=w> </span><span class=l>follow-schema</span><span class=w>
</span><span class=w>  </span><span class=nt>dir</span><span class=p>:</span><span class=w> </span><span class=l>.</span><span class=w>
</span><span class=w>
</span><span class=w></span><span class=c># gqlgen will search for any type names in the schema in the generated</span><span class=w>
</span><span class=w></span><span class=c># ent package. If they match it will use them, otherwise it will new ones.</span><span class=w>
</span><span class=w></span><span class=nt>autobind</span><span class=p>:</span><span class=w>
</span><span class=w>  </span>- <span class=l>github.com/facebookincubator/ent-contrib/entgql/internal/todo/ent</span><span class=w>
</span><span class=w>
</span><span class=w></span><span class=nt>models</span><span class=p>:</span><span class=w>
</span><span class=w>  </span><span class=nt>ID</span><span class=p>:</span><span class=w>
</span><span class=w>    </span><span class=nt>model</span><span class=p>:</span><span class=w>
</span><span class=w>      </span>- <span class=l>github.com/99designs/gqlgen/graphql.IntID</span><span class=w>
</span><span class=w>  </span><span class=nt>Node</span><span class=p>:</span><span class=w>
</span><span class=w>    </span><span class=nt>model</span><span class=p>:</span><span class=w>
</span><span class=w>      </span><span class=c># ent.Noder is the new interface generated by the Node template.</span><span class=w>
</span><span class=w>      </span>- <span class=l>github.com/facebookincubator/ent-contrib/entgql/internal/todo/ent.Noder</span><span class=w>
</span></code></pre></div><h2 id=pagination>Pagination</h2><p>The pagination template adds a pagination support according to the <em>Relay Cursor Connections Spec</em>. More info about the Relay Spec can be found in its <a href=https://relay.dev/graphql/connections.htm>website</a>.</p><h2 id=connection-ordering>Connection Ordering</h2><p>The ordering option allows us to apply an ordering on the edges returned from a connection.</p><h3 id=usage-notes>Usage Notes</h3><ul><li>The generated types will be <code>autobind</code>ed to GraphQL types if a naming convention is preserved (see example below).</li><li>Ordering can only be defined on ent fields (no edges).</li><li>Ordering fields should normally be <a href=schema-indexes.md>indexed</a> to avoid full table DB scan.</li><li>Pagination queries can be sorted by a single field (no order by &mldr; then by &mldr; semantics).</li></ul><h3 id=example>Example</h3><p>Let&rsquo;s go over the steps needed in order to add ordering to an existing GraphQL type.
The code example is based on a todo-app that can be found in <a href=https://github.com/facebookincubator/ent-contrib/tree/master/entgql/internal/todo>ent-contrib/entql/todo</a>.</p><h3 id=defining-order-fields-in-entschema>Defining order fields in ent/schema</h3><p>Ordering can be defined on any comparable field of ent by annotating it with <code>entgql.Annotation</code>.
Note that the given <code>OrderField</code> name must match its enum value in graphql schema.</p><div class=highlight><pre class=chroma><code class=language-go data-lang=go><span class=kd>func</span> <span class=p>(</span><span class=nx>Todo</span><span class=p>)</span> <span class=nf>Fields</span><span class=p>()</span> <span class=p>[]</span><span class=nx>ent</span><span class=p>.</span><span class=nx>Field</span> <span class=p>{</span>
    <span class=k>return</span> <span class=p>[]</span><span class=nx>ent</span><span class=p>.</span><span class=nx>Field</span><span class=p>{</span>
	    <span class=nx>field</span><span class=p>.</span><span class=nf>Time</span><span class=p>(</span><span class=s>&#34;created_at&#34;</span><span class=p>).</span>
			<span class=nf>Default</span><span class=p>(</span><span class=nx>time</span><span class=p>.</span><span class=nx>Now</span><span class=p>).</span>
			<span class=nf>Immutable</span><span class=p>().</span>
			<span class=nf>Annotations</span><span class=p>(</span>
				<span class=nx>entgql</span><span class=p>.</span><span class=nf>OrderField</span><span class=p>(</span><span class=s>&#34;CREATED_AT&#34;</span><span class=p>),</span>
			<span class=p>),</span>
		<span class=nx>field</span><span class=p>.</span><span class=nf>Enum</span><span class=p>(</span><span class=s>&#34;status&#34;</span><span class=p>).</span>
			<span class=nf>NamedValues</span><span class=p>(</span>
				<span class=s>&#34;InProgress&#34;</span><span class=p>,</span> <span class=s>&#34;IN_PROGRESS&#34;</span><span class=p>,</span>
				<span class=s>&#34;Completed&#34;</span><span class=p>,</span> <span class=s>&#34;COMPLETED&#34;</span><span class=p>,</span>
			<span class=p>).</span>
			<span class=nf>Annotations</span><span class=p>(</span>
				<span class=nx>entgql</span><span class=p>.</span><span class=nf>OrderField</span><span class=p>(</span><span class=s>&#34;STATUS&#34;</span><span class=p>),</span>
			<span class=p>),</span>
		<span class=nx>field</span><span class=p>.</span><span class=nf>Int</span><span class=p>(</span><span class=s>&#34;priority&#34;</span><span class=p>).</span>
			<span class=nf>Default</span><span class=p>(</span><span class=mi>0</span><span class=p>).</span>
			<span class=nf>Annotations</span><span class=p>(</span>
				<span class=nx>entgql</span><span class=p>.</span><span class=nf>OrderField</span><span class=p>(</span><span class=s>&#34;PRIORITY&#34;</span><span class=p>),</span>
			<span class=p>),</span>
		<span class=nx>field</span><span class=p>.</span><span class=nf>Text</span><span class=p>(</span><span class=s>&#34;text&#34;</span><span class=p>).</span>
			<span class=nf>NotEmpty</span><span class=p>().</span>
			<span class=nf>Annotations</span><span class=p>(</span>
				<span class=nx>entgql</span><span class=p>.</span><span class=nf>OrderField</span><span class=p>(</span><span class=s>&#34;TEXT&#34;</span><span class=p>),</span>
			<span class=p>),</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></div><p>That&rsquo;s all the schema changes required, make sure to run <code>go generate</code> to apply them.</p><h3 id=define-ordering-types-in-graphql-schema>Define ordering types in GraphQL schema</h3><p>Next we need to define the ordering types in graphql schema:</p><div class=highlight><pre class=chroma><code class=language-graphql data-lang=graphql><span class=kd>enum</span><span class=w> </span><span class=nc>OrderDirection</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>	</span><span class=py>ASC</span><span class=w>
</span><span class=w>	</span><span class=py>DESC</span><span class=w>
</span><span class=w></span><span class=p>}</span><span class=w>
</span><span class=w>
</span><span class=w></span><span class=kd>enum</span><span class=w> </span><span class=nc>TodoOrderField</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>	</span><span class=py>CREATED_AT</span><span class=w>
</span><span class=w>	</span><span class=py>PRIORITY</span><span class=w>
</span><span class=w>	</span><span class=py>STATUS</span><span class=w>
</span><span class=w>	</span><span class=py>TEXT</span><span class=w>
</span><span class=w></span><span class=p>}</span><span class=w>
</span><span class=w>
</span><span class=w></span><span class=kd>input</span><span class=w> </span><span class=nc>TodoOrder</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>	</span><span class=py>direction</span><span class=p>:</span><span class=w> </span><span class=nc>OrderDirection</span><span class=p>!</span><span class=w>
</span><span class=w>	</span><span class=py>field</span><span class=p>:</span><span class=w> </span><span class=nc>TodoOrderField</span><span class=w>
</span><span class=w></span><span class=p>}</span><span class=w>
</span></code></pre></div><p>Note that the naming must take the form of <code>&lt;T>OrderField</code> / <code>&lt;T>Order</code> for <code>autobind</code>ing to the generated ent types.
Alternatively <a href=https://gqlgen.com/config/#inline-config-with-directives>@goModel</a> directive can be used for manual type binding.</p><h3 id=adding-orderby-argument-to-the-pagination-query>Adding orderBy argument to the pagination query</h3><div class=highlight><pre class=chroma><code class=language-graphql data-lang=graphql><span class=kd>type</span><span class=w> </span><span class=nc>Query</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>	</span><span class=py>todos</span><span class=p>(</span><span class=w>
</span><span class=w>		</span><span class=py>after</span><span class=p>:</span><span class=w> </span><span class=nc>Cursor</span><span class=w>
</span><span class=w>		</span><span class=py>first</span><span class=p>:</span><span class=w> </span><span class=nc>Int</span><span class=w>
</span><span class=w>		</span><span class=py>before</span><span class=p>:</span><span class=w> </span><span class=nc>Cursor</span><span class=w>
</span><span class=w>		</span><span class=py>last</span><span class=p>:</span><span class=w> </span><span class=nc>Int</span><span class=w>
</span><span class=w>		</span><span class=py>orderBy</span><span class=p>:</span><span class=w> </span><span class=nc>TodoOrder</span><span class=w>
</span><span class=w>	</span><span class=p>):</span><span class=w> </span><span class=nc>TodoConnection</span><span class=w>
</span><span class=w></span><span class=p>}</span><span class=w>
</span></code></pre></div><p>That&rsquo;s all for the GraphQL schema changes, let&rsquo;s run <code>gqlgen</code> code generation.</p><h3 id=update-the-underlying-resolver>Update the underlying resolver</h3><p>Head over to the Todo resolver and update it to pass <code>orderBy</code> argument to <code>.Paginate()</code> call:</p><div class=highlight><pre class=chroma><code class=language-go data-lang=go><span class=kd>func</span> <span class=p>(</span><span class=nx>r</span> <span class=o>*</span><span class=nx>queryResolver</span><span class=p>)</span> <span class=nf>Todos</span><span class=p>(</span><span class=nx>ctx</span> <span class=nx>context</span><span class=p>.</span><span class=nx>Context</span><span class=p>,</span> <span class=nx>after</span> <span class=o>*</span><span class=nx>ent</span><span class=p>.</span><span class=nx>Cursor</span><span class=p>,</span> <span class=nx>first</span> <span class=o>*</span><span class=kt>int</span><span class=p>,</span> <span class=nx>before</span> <span class=o>*</span><span class=nx>ent</span><span class=p>.</span><span class=nx>Cursor</span><span class=p>,</span> <span class=nx>last</span> <span class=o>*</span><span class=kt>int</span><span class=p>,</span> <span class=nx>orderBy</span> <span class=o>*</span><span class=nx>ent</span><span class=p>.</span><span class=nx>TodoOrder</span><span class=p>)</span> <span class=p>(</span><span class=o>*</span><span class=nx>ent</span><span class=p>.</span><span class=nx>TodoConnection</span><span class=p>,</span> <span class=kt>error</span><span class=p>)</span> <span class=p>{</span>
	<span class=k>return</span> <span class=nx>r</span><span class=p>.</span><span class=nx>client</span><span class=p>.</span><span class=nx>Todo</span><span class=p>.</span><span class=nf>Query</span><span class=p>().</span>
		<span class=nf>Paginate</span><span class=p>(</span><span class=nx>ctx</span><span class=p>,</span> <span class=nx>after</span><span class=p>,</span> <span class=nx>first</span><span class=p>,</span> <span class=nx>before</span><span class=p>,</span> <span class=nx>last</span><span class=p>,</span>
			<span class=nx>ent</span><span class=p>.</span><span class=nf>WithTodoOrder</span><span class=p>(</span><span class=nx>orderBy</span><span class=p>),</span>
		<span class=p>)</span>
<span class=p>}</span>
</code></pre></div><h3 id=use-in-graphql>Use in GraphQL</h3><div class=highlight><pre class=chroma><code class=language-text data-lang=text>query {
    todos(first: 3, orderBy: {direction: DESC, field: NAME}) {
        edges {
            node {
                name
            }
        }
    }
}
</code></pre></div><h2 id=fields-collection>Fields Collection</h2><p>The collection template adds support for automatic fields collection from GraphQL requests using eager-loading the ent-edges. In order to configure this option to specific edges, use the <code>entgql.Annotation</code> as follows:</p><div class=highlight><pre class=chroma><code class=language-go data-lang=go><span class=kd>func</span> <span class=p>(</span><span class=nx>Todo</span><span class=p>)</span> <span class=nf>Edges</span><span class=p>()</span> <span class=p>[]</span><span class=nx>ent</span><span class=p>.</span><span class=nx>Edge</span> <span class=p>{</span>
    <span class=k>return</span> <span class=p>[]</span><span class=nx>ent</span><span class=p>.</span><span class=nx>Edge</span><span class=p>{</span>
        <span class=nx>edge</span><span class=p>.</span><span class=nf>To</span><span class=p>(</span><span class=s>&#34;children&#34;</span><span class=p>,</span> <span class=nx>Todo</span><span class=p>.</span><span class=nx>Type</span><span class=p>).</span>
            <span class=nf>Annotations</span><span class=p>(</span><span class=nx>entgql</span><span class=p>.</span><span class=nf>Bind</span><span class=p>()).</span>
            <span class=nf>From</span><span class=p>(</span><span class=s>&#34;parent&#34;</span><span class=p>).</span>
            <span class=c1>// Bind implies the edge name in graphql schema is
</span><span class=c1></span>            <span class=c1>// equivalent to the name used in ent schema.
</span><span class=c1></span>            <span class=nf>Annotations</span><span class=p>(</span><span class=nx>entgql</span><span class=p>.</span><span class=nf>Bind</span><span class=p>()).</span>
            <span class=nf>Unique</span><span class=p>(),</span>
        <span class=nx>edge</span><span class=p>.</span><span class=nf>From</span><span class=p>(</span><span class=s>&#34;owner&#34;</span><span class=p>,</span> <span class=nx>User</span><span class=p>.</span><span class=nx>Type</span><span class=p>).</span>
            <span class=nf>Ref</span><span class=p>(</span><span class=s>&#34;tasks&#34;</span><span class=p>).</span>
            <span class=c1>// Map edge names as defined in graphql schema.
</span><span class=c1></span>            <span class=nf>Annotations</span><span class=p>(</span><span class=nx>entgql</span><span class=p>.</span><span class=nf>MapsTo</span><span class=p>(</span><span class=s>&#34;taskOwner&#34;</span><span class=p>)),</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></div><p>Then, in the resolver, use it as follows:</p><div class=highlight><pre class=chroma><code class=language-go data-lang=go><span class=kd>func</span> <span class=p>(</span><span class=nx>r</span> <span class=o>*</span><span class=nx>todoResolver</span><span class=p>)</span> <span class=nf>Parent</span><span class=p>(</span><span class=nx>ctx</span> <span class=nx>context</span><span class=p>.</span><span class=nx>Context</span><span class=p>,</span> <span class=nx>t</span> <span class=o>*</span><span class=nx>ent</span><span class=p>.</span><span class=nx>Todo</span><span class=p>)</span> <span class=p>(</span><span class=o>*</span><span class=nx>ent</span><span class=p>.</span><span class=nx>Todo</span><span class=p>,</span> <span class=kt>error</span><span class=p>)</span> <span class=p>{</span>
	<span class=nx>parent</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>t</span><span class=p>.</span><span class=nx>Edges</span><span class=p>.</span><span class=nf>ParentOrErr</span><span class=p>()</span>
	<span class=k>return</span> <span class=nx>parent</span><span class=p>,</span> <span class=nx>ent</span><span class=p>.</span><span class=nf>MaskNotFound</span><span class=p>(</span><span class=nx>err</span><span class=p>)</span>
<span class=p>}</span>

<span class=kd>func</span> <span class=p>(</span><span class=nx>r</span> <span class=o>*</span><span class=nx>todoResolver</span><span class=p>)</span> <span class=nf>Children</span><span class=p>(</span><span class=nx>ctx</span> <span class=nx>context</span><span class=p>.</span><span class=nx>Context</span><span class=p>,</span> <span class=nx>obj</span> <span class=o>*</span><span class=nx>ent</span><span class=p>.</span><span class=nx>Todo</span><span class=p>)</span> <span class=p>([]</span><span class=o>*</span><span class=nx>ent</span><span class=p>.</span><span class=nx>Todo</span><span class=p>,</span> <span class=kt>error</span><span class=p>)</span> <span class=p>{</span>
	<span class=k>return</span> <span class=nx>obj</span><span class=p>.</span><span class=nx>Edges</span><span class=p>.</span><span class=nf>ChildrenOrErr</span><span class=p>()</span>
<span class=p>}</span>
</code></pre></div><p>More info about fields-collection can be found in <a href=https://spec.graphql.org/June2018/#sec-Field-Collection>Relay website</a>.</p><h2 id=enum-implementation>Enum Implementation</h2><p>The enum template implements the MarshalGQL/UnmarshalGQL methods for enums generated by ent.</p><h2 id=transactional-mutations>Transactional Mutations</h2><p>The <code>entgql.Transactioner</code> handler executes each GraphQL mutation in a transaction. The injected client for the resolver is a <a href=transactions.md#transactional-client>transactional <code>ent.Client</code></a>.
Hence, code that uses <code>ent.Client</code> won&rsquo;t need to be changed. In order to use it, follow these steps:</p><p>1. In the GraphQL server initialization, use the <code>entgql.Transactioner</code> handler as follows:</p><div class=highlight><pre class=chroma><code class=language-go data-lang=go><span class=nx>srv</span> <span class=o>:=</span> <span class=nx>handler</span><span class=p>.</span><span class=nf>NewDefaultServer</span><span class=p>(</span><span class=nx>todo</span><span class=p>.</span><span class=nf>NewSchema</span><span class=p>(</span><span class=nx>client</span><span class=p>))</span>
<span class=nx>srv</span><span class=p>.</span><span class=nf>Use</span><span class=p>(</span><span class=nx>entgql</span><span class=p>.</span><span class=nx>Transactioner</span><span class=p>{</span><span class=nx>TxOpener</span><span class=p>:</span> <span class=nx>client</span><span class=p>})</span>
</code></pre></div><p>2. And then, in the GraphQL mutations, use the client from context as follows:</p><div class=highlight><pre class=chroma><code class=language-go data-lang=go><span class=kd>func</span> <span class=p>(</span><span class=nx>mutationResolver</span><span class=p>)</span> <span class=nf>CreateTodo</span><span class=p>(</span><span class=nx>ctx</span> <span class=nx>context</span><span class=p>.</span><span class=nx>Context</span><span class=p>,</span> <span class=nx>todo</span> <span class=nx>TodoInput</span><span class=p>)</span> <span class=p>(</span><span class=o>*</span><span class=nx>ent</span><span class=p>.</span><span class=nx>Todo</span><span class=p>,</span> <span class=kt>error</span><span class=p>)</span> <span class=p>{</span>
	<span class=nx>client</span> <span class=o>:=</span> <span class=nx>ent</span><span class=p>.</span><span class=nf>FromContext</span><span class=p>(</span><span class=nx>ctx</span><span class=p>)</span>
	<span class=k>return</span> <span class=nx>client</span><span class=p>.</span><span class=nx>Todo</span><span class=p>.</span>
		<span class=nf>Create</span><span class=p>().</span>
		<span class=nf>SetStatus</span><span class=p>(</span><span class=nx>todo</span><span class=p>.</span><span class=nx>Status</span><span class=p>).</span>
		<span class=nf>SetNillablePriority</span><span class=p>(</span><span class=nx>todo</span><span class=p>.</span><span class=nx>Priority</span><span class=p>).</span>
		<span class=nf>SetText</span><span class=p>(</span><span class=nx>todo</span><span class=p>.</span><span class=nx>Text</span><span class=p>).</span>
		<span class=nf>SetNillableParentID</span><span class=p>(</span><span class=nx>todo</span><span class=p>.</span><span class=nx>Parent</span><span class=p>).</span>
		<span class=nf>Save</span><span class=p>(</span><span class=nx>ctx</span><span class=p>)</span>
<span class=p>}</span>
</code></pre></div><hr><p>Please note that this documentation is under development. All code parts reside in <a href=https://github.com/facebookincubator/ent-contrib/tree/master/entgql>ent-contrib/entgql</a>,and an example of a todo-app can be found in <a href=https://github.com/facebookincubator/ent-contrib/tree/master/entgql/internal/todo>ent-contrib/entql/todo</a>.</p></div></main></body></html>