<!doctype html><html><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=.9,maximum-scale=.9"><meta name=description content="Changes in gqlgen 0.11"><title>Migrating to 0.11 &mdash; gqlgen</title><link href="https://fonts.googleapis.com/css?family=Roboto:400,400i,700|Source+Code+Pro:400,700|Work+Sans:500,700" rel=stylesheet><link rel=stylesheet href="https://gqlgen.com/main.css?v=3" type=text/css><link rel=stylesheet href="https://gqlgen.com/syntax.css?v=2" type=text/css><script async src="https://www.googletagmanager.com/gtag/js?id=UA-116208894-2"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}
gtag('js',new Date());gtag('config','UA-116208894-2');</script><script src="https://gqlgen.com/main.js?v=1" async></script></head><body><div class=version-switcher><span></span><div class=version-switcher-options><a class=version-switcher-option></a></div></div><div class=layout--logo><a class=logo href=http://github.com/99designs/gqlgen><svg viewBox="0 0 31.92 31.43" xmlns="http://www.w3.org/2000/svg"><g transform="translate(-79.29 -106.7)"><path transform="matrix(.2646 0 0 .2646 79.29 106.7)" d="m31.95.0c-5.673.0-10.27 4.598-10.27 10.27.0.5862.06001 1.157.1543 1.717l-19.74 11.39c-1.239.5653-2.1 1.816-2.1 3.266v65.51h.01562c.001603 1.235.6446 2.437 1.793 3.096l20.03 11.56c-.09429.5594-.1543 1.131-.1543 1.717.0 5.673 4.598 10.27 10.27 10.27 5.674.0 10.27-4.6 10.27-10.27.0-5.673-4.598-10.27-10.27-10.27-2.492.0-4.774.8879-6.553 2.363l-18.22-10.52v-61.4l18.22-10.52c1.778 1.475 4.061 2.363 6.553 2.363 5.674.0 10.27-4.6 10.27-10.27.0-5.673-4.598-10.27-10.27-10.27zm56.73.0c-5.673.0-10.27 4.598-10.27 10.27.0 5.673 4.598 10.27 10.27 10.27 2.492.0 4.776-.8879 6.555-2.363l18.22 10.52v61.4l-18.22 10.52c-1.778-1.474-4.062-2.361-6.553-2.361-5.673.0-10.27 4.598-10.27 10.27.0 5.673 4.598 10.27 10.27 10.27 5.675.0 10.27-4.6 10.27-10.27.0-.5862-.06002-1.157-.1543-1.717l19.74-11.39c1.239-.5653 2.1-1.814 2.1-3.264v-65.51h-.01562c-.00133-1.236-.6437-2.438-1.793-3.098l-20.03-11.56c.09428-.5594.1543-1.131.1543-1.717.0-5.673-4.597-10.27-10.27-10.27zm-28.37 20.76c-5.675.0-10.27 4.598-10.27 10.27.0 1.524.3402 2.967.9355 4.268l-14.76 14.76c-1.301-.5953-2.742-.9355-4.266-.9355-5.673.0-10.27 4.598-10.27 10.27.0 5.673 4.598 10.27 10.27 10.27 1.524.0 2.963-.3406 4.264-.9355l14.77 14.77c-.5953 1.301-.9355 2.742-.9355 4.266.0 5.673 4.599 10.27 10.27 10.27 5.672.0 10.27-4.596 10.27-10.27.0-1.524-.3401-2.965-.9355-4.266l15.63-15.63c.5748.0998 1.162.1621 1.766.1621 5.675.0 10.27-4.598 10.27-10.27.0-5.675-4.599-10.27-10.27-10.27-1.524.0-2.965.3404-4.266.9355l-13.13-13.13c.5954-1.301.9355-2.743.9355-4.268.0-5.673-4.599-10.27-10.27-10.27zm-4.266 19.61c1.3.5949 2.742.9355 4.266.9355 1.523.0 2.964-.3408 4.264-.9355l13.13 13.13c-.5948 1.3-.9355 2.742-.9355 4.266.0 2.377.8147 4.558 2.17 6.299l-14.36 14.37c-1.3-.5947-2.741-.9336-4.264-.9336-1.524.0-2.965.3388-4.266.9336l-14.77-14.77c.5949-1.3.9355-2.74.9355-4.264.0-1.523-.3389-2.964-.9336-4.264l14.76-14.77z"/></g></svg><span class=logo--name>gqlgen</span></a></div><nav><input class=hamburger-toggle type=checkbox><div class=hamburger><span></span><span></span><span></span></div><ul class=menu><li><a class=menu-item href=https://gqlgen.com/>Introduction</a></li><li><a class=menu-item href=https://gqlgen.com/getting-started/>Getting Started</a></li><li><a class=menu-item href=https://gqlgen.com/config/>Configuration</a></li><li><a class=menu-item href=https://gqlgen.com/feature-comparison/>Feature Comparison</a></li><li><span class="menu-item submenu-heading">Reference</span><ul class=submenu><li><a class=menu-item href=https://gqlgen.com/reference/apq/>APQ</a></li><li><a class=menu-item href=https://gqlgen.com/reference/changesets/>Changesets</a></li><li><a class=menu-item href=https://gqlgen.com/reference/dataloaders/>Dataloaders</a></li><li><a class=menu-item href=https://gqlgen.com/reference/field-collection/>Field Collection</a></li><li><a class=menu-item href=https://gqlgen.com/reference/file-upload/>File Upload</a></li><li><a class=menu-item href=https://gqlgen.com/reference/errors/>Handling Errors</a></li><li><a class=menu-item href=https://gqlgen.com/reference/introspection/>Introspection</a></li><li><a class=menu-item href=https://gqlgen.com/reference/plugins/>Plugins</a></li><li><a class=menu-item href=https://gqlgen.com/reference/complexity/>Query Complexity</a></li><li><a class=menu-item href=https://gqlgen.com/reference/resolvers/>Resolvers</a></li><li><a class=menu-item href=https://gqlgen.com/reference/scalars/>Scalars</a></li><li><a class=menu-item href=https://gqlgen.com/reference/directives/>Schema Directives</a></li><li><a class=menu-item href=https://godoc.org/github.com/99designs/gqlgen>godoc
<span class=icon><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><path d="M576 24v127.984c0 21.461-25.96 31.98-40.971 16.971l-35.707-35.709-243.523 243.523c-9.373 9.373-24.568 9.373-33.941.0l-22.627-22.627c-9.373-9.373-9.373-24.569.0-33.941L442.756 76.676l-35.703-35.705C391.982 25.9 402.656.0 424.024.0H552c13.255.0 24 10.745 24 24zM407.029 270.794l-16 16A23.999 23.999.0 00384 303.765V448H64V128h264a24.003 24.003.0 0016.97-7.029l16-16C376.089 89.851 365.381 64 344 64H48C21.49 64 0 85.49.0 112v352c0 26.51 21.49 48 48 48h352c26.51.0 48-21.49 48-48V287.764c0-21.382-25.852-32.09-40.971-16.97z"/></svg></span></a></li></ul></li><li><span class="menu-item submenu-heading">Recipes</span><ul class=submenu><li><a class=menu-item href=https://gqlgen.com/recipes/federation/>Apollo Federation</a></li><li><a class=menu-item href=https://gqlgen.com/recipes/authentication/>Authentication</a></li><li><a class=menu-item href=https://gqlgen.com/recipes/cors/>CORS</a></li><li><a class=menu-item href=https://gqlgen.com/recipes/gin/>Gin</a></li><li class=active><a class=menu-item href=https://gqlgen.com/recipes/migration-0.11/>Migrating to 0.11</a></li><li><a class=menu-item href=https://gqlgen.com/recipes/modelgen-hook/>Modelgen hook</a></li></ul></li></ul></nav><header><div class=content><h1>Migrating to 0.11</h1><div class=description>Migrating to 0.11</div><a class=header-link target=_blank href=https://github.com/99designs/gqlgen/blob/master/docs/content/recipes/migration-0.11.md>[edit]</a></div></header><main><div class=content><h2 id=updated-gqlparser>Updated gqlparser</h2><p>gqlparser had a breaking change, if you have any references to it in your project your going to need to update
them from <code>github.com/vektah/gqlparser</code> to <code>github.com/vektah/gqlparser/v2</code>.</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>sed -i <span class=s1>&#39;s/github.com\/vektah\/gqlparser/github.com\/vektah\/gqlparser\/v2/&#39;</span> <span class=k>$(</span>find -name <span class=s1>&#39;*.go&#39;</span><span class=k>)</span>
</code></pre></div><h2 id=handler-refactor>Handler Refactor</h2><p>The handler package has grown organically for a long time, 0.11 is a large cleanup of the handler package to make it
more modular and easier to maintain once we get to 1.0.</p><h3 id=transports>Transports</h3><p>Transports are the first thing that run, they handle decoding the incoming http request, and encoding the graphql
response. Supported transports are:</p><ul><li>GET</li><li>JSON POST</li><li>Multipart form</li><li>Websockets</li></ul><p>new usage looks like this</p><div class=highlight><pre class=chroma><code class=language-go data-lang=go><span class=nx>srv</span> <span class=o>:=</span> <span class=nf>New</span><span class=p>(</span><span class=nx>es</span><span class=p>)</span>

<span class=nx>srv</span><span class=p>.</span><span class=nf>AddTransport</span><span class=p>(</span><span class=nx>transport</span><span class=p>.</span><span class=nx>Websocket</span><span class=p>{</span>
	<span class=nx>KeepAlivePingInterval</span><span class=p>:</span> <span class=mi>10</span> <span class=o>*</span> <span class=nx>time</span><span class=p>.</span><span class=nx>Second</span><span class=p>,</span>
<span class=p>})</span>
<span class=nx>srv</span><span class=p>.</span><span class=nf>AddTransport</span><span class=p>(</span><span class=nx>transport</span><span class=p>.</span><span class=nx>Options</span><span class=p>{})</span>
<span class=nx>srv</span><span class=p>.</span><span class=nf>AddTransport</span><span class=p>(</span><span class=nx>transport</span><span class=p>.</span><span class=nx>GET</span><span class=p>{})</span>
<span class=nx>srv</span><span class=p>.</span><span class=nf>AddTransport</span><span class=p>(</span><span class=nx>transport</span><span class=p>.</span><span class=nx>POST</span><span class=p>{})</span>
<span class=nx>srv</span><span class=p>.</span><span class=nf>AddTransport</span><span class=p>(</span><span class=nx>transport</span><span class=p>.</span><span class=nx>MultipartForm</span><span class=p>{})</span>
</code></pre></div><h3 id=new-handler-extension-api>New handler extension API</h3><p>The core of this changes the handler package to be a set of composable extensions. The extensions implement a set of optional interfaces:</p><ul><li><strong>OperationParameterMutator</strong> runs before creating a OperationContext (formerly RequestContext). allows manipulating the raw query before parsing.</li><li><strong>OperationContextMutator</strong> runs after creating the OperationContext, but before executing the root resolver.</li><li><strong>OperationInterceptor</strong> runs for each incoming query after parsing and validation, for basic requests the writer will be invoked once, for subscriptions it will be invoked multiple times.</li><li><strong>ResponseInterceptor</strong> runs around each graphql operation response. This can be called many times for a single operation the case of subscriptions.</li><li><strong>FieldInterceptor</strong> runs around each field</li></ul><p><img src=https://user-images.githubusercontent.com/2247982/68181515-c8a27c00-ffeb-11e9-86f6-1673e7179ecb.png alt="Anatomy of a request@2x"></p><p>Users of an extension should not need to know which extension points are being used by a given extension, they are added to the server simply by calling <code>Use(extension)</code>.</p><p>There are a few convenience methods for defining middleware inline, instead of creating an extension</p><div class=highlight><pre class=chroma><code class=language-go data-lang=go><span class=nx>srv</span> <span class=o>:=</span> <span class=nx>handler</span><span class=p>.</span><span class=nf>New</span><span class=p>(</span><span class=nx>es</span><span class=p>)</span>
<span class=nx>srv</span><span class=p>.</span><span class=nf>AroundFields</span><span class=p>(</span><span class=kd>func</span><span class=p>(</span><span class=nx>ctx</span> <span class=nx>context</span><span class=p>.</span><span class=nx>Context</span><span class=p>,</span> <span class=nx>next</span> <span class=nx>graphql</span><span class=p>.</span><span class=nx>Resolver</span><span class=p>)</span> <span class=p>(</span><span class=nx>res</span> <span class=kd>interface</span><span class=p>{},</span> <span class=nx>err</span> <span class=kt>error</span><span class=p>)</span> <span class=p>{</span>
	<span class=c1>// this function will be called around every field. next() will evaluate the field and return
</span><span class=c1></span>	<span class=c1>// its computed value.
</span><span class=c1></span>	<span class=k>return</span> <span class=nf>next</span><span class=p>(</span><span class=nx>ctx</span><span class=p>)</span>
<span class=p>})</span>
<span class=nx>srv</span><span class=p>.</span><span class=nf>AroundOperations</span><span class=p>(</span><span class=kd>func</span><span class=p>(</span><span class=nx>ctx</span> <span class=nx>context</span><span class=p>.</span><span class=nx>Context</span><span class=p>,</span> <span class=nx>next</span> <span class=nx>graphql</span><span class=p>.</span><span class=nx>OperationHandler</span><span class=p>)</span> <span class=nx>graphql</span><span class=p>.</span><span class=nx>ResponseHandler</span> <span class=p>{</span>
	<span class=c1>// This function will be called around every operation, next() will return a function that when
</span><span class=c1></span>	<span class=c1>// called will evaluate one response. Eventually next will return nil, signalling there are no
</span><span class=c1></span>	<span class=c1>// more results to be returned by the server.
</span><span class=c1></span>	<span class=k>return</span> <span class=nf>next</span><span class=p>(</span><span class=nx>ctx</span><span class=p>)</span>
<span class=p>})</span>
<span class=nx>srv</span><span class=p>.</span><span class=nf>AroundResponses</span><span class=p>(</span><span class=kd>func</span><span class=p>(</span><span class=nx>ctx</span> <span class=nx>context</span><span class=p>.</span><span class=nx>Context</span><span class=p>,</span> <span class=nx>next</span> <span class=nx>graphql</span><span class=p>.</span><span class=nx>ResponseHandler</span><span class=p>)</span> <span class=o>*</span><span class=nx>graphql</span><span class=p>.</span><span class=nx>Response</span> <span class=p>{</span>
	<span class=c1>// This function will be called around each response in the operation. next() will evaluate
</span><span class=c1></span>	<span class=c1>// and return a single response.
</span><span class=c1></span>	<span class=k>return</span> <span class=nf>next</span><span class=p>(</span><span class=nx>ctx</span><span class=p>)</span>
<span class=p>})</span>
</code></pre></div><p>Some of the features supported out of the box by handler extensions:</p><ul><li>APQ</li><li>Query Complexity</li><li>Error Presenters and Recover Func</li><li>Introspection Query support</li><li>Query AST cache</li><li>Tracing API</li></ul><p>They can be <code>Use</code>&rsquo;d like this:</p><div class=highlight><pre class=chroma><code class=language-go data-lang=go><span class=nx>srv</span> <span class=o>:=</span> <span class=nx>handler</span><span class=p>.</span><span class=nf>New</span><span class=p>(</span><span class=nx>es</span><span class=p>)</span>
<span class=nx>srv</span><span class=p>.</span><span class=nf>Use</span><span class=p>(</span><span class=nx>extension</span><span class=p>.</span><span class=nx>Introspection</span><span class=p>{})</span>
<span class=nx>srv</span><span class=p>.</span><span class=nf>Use</span><span class=p>(</span><span class=nx>extension</span><span class=p>.</span><span class=nx>AutomaticPersistedQuery</span><span class=p>{</span>
	<span class=nx>Cache</span><span class=p>:</span> <span class=nx>lru</span><span class=p>.</span><span class=nf>New</span><span class=p>(</span><span class=mi>100</span><span class=p>),</span>
<span class=p>})</span>
<span class=nx>srv</span><span class=p>.</span><span class=nf>Use</span><span class=p>(</span><span class=nx>apollotracing</span><span class=p>.</span><span class=nx>Tracer</span><span class=p>{})</span>
</code></pre></div><h3 id=default-server>Default server</h3><p>We provide a set of default extensions and transports if you aren&rsquo;t ready to customize them yet. Simply:</p><div class=highlight><pre class=chroma><code class=language-go data-lang=go><span class=nx>handler</span><span class=p>.</span><span class=nf>NewDefaultServer</span><span class=p>(</span><span class=nx>es</span><span class=p>)</span>
</code></pre></div><h3 id=more-consistent-naming>More consistent naming</h3><p>As part of cleaning up the names the RequestContext has been renamed to OperationContext, as there can be multiple created during the lifecycle of a request. A new ResponseContext has also been created and error handling has been moved here. This allows each response in a subscription to have its own errors. I&rsquo;m not sure what bugs this might have been causing before&mldr;</p><h3 id=removal-of-tracing>Removal of tracing</h3><p>Many of the old interfaces collapse down into just a few extension points:</p><p><img src=https://gqlgen.com/request_anatomy.png alt="Anatomy of a request"></p><p>The tracing interface has also been removed, tracing stats are now measured in core (eg time to parse query) and made available on the operation/response contexts. Much of the old interface was designed so that users of a tracer dont need to know which extension points it was listening to, the new handler extensions have the same goal.</p><h3 id=backward-compatibility>Backward compatibility</h3><p>There is a backwards compatibility layer that keeps most of the original interface in place. There are a few places where BC is known to be broken:</p><ul><li>ResponseMiddleware: The signature used to be <code>func(ctx context.Context, next func(ctx context.Context) []byte) []byte</code> and is now <code>func(ctx context.Context) *Response</code>. We could maintain BC by marshalling to json before and after, but the change is pretty easy to make and is likely to cause less issues.</li><li>The Tracer interface has been removed, any tracers will need to be reimplemented against the new extension interface.</li></ul><h2 id=new-resolver-layout>New resolver layout</h2><p>0.11 also added a new way to generate and layout resolvers on disk. We used to only generate resolver implementations
whenever the file didnt exist. This behaviour is still there for those that are already used to it, However there is a
new mode you can turn on in config:</p><div class=highlight><pre class=chroma><code class=language-yaml data-lang=yaml><span class=nt>resolver</span><span class=p>:</span><span class=w>
</span><span class=w>  </span><span class=nt>layout</span><span class=p>:</span><span class=w> </span><span class=l>follow-schema</span><span class=w>
</span><span class=w>  </span><span class=nt>dir</span><span class=p>:</span><span class=w> </span><span class=l>graph</span><span class=w>
</span></code></pre></div><p>This tells gqlgen to generate resolvers next to the schema file that declared the graphql field, which looks like this:</p><p><img src=https://gqlgen.com/schema_layout.png alt="follow-schema layout"></p></div></main></body></html>